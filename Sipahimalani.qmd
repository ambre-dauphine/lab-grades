---
title: "Sipahimalani"
author: "Ambre Sipahimalani"
format: html
---
```{r}
#| message: false
#| warning: false
here::i_am("lab-grades.Rproj")
library(here)
library(ggplot2)
library(dplyr)
library(tidyr)
library(vroom)
library(readr)
library(lubridate)
```
Link to the Github repository : https://github.com/ambre-dauphine/lab-grades.git

## Question 1

```{r}
#| message: false
course <- vroom(here("data","courses.csv"))
```

## Question 2

```{r}
course|>
  arrange(course)|>
  rename(`course name`=course, identifier=course_id, `number of exams`=nb_grades)|>
    knitr::kable()
```

### Question 3 

```{r}
#| message: false
students <- read_delim(here("data","students.csv"),
                       col_types=cols(
                         id=col_integer(),
                         group=col_factor(),
                         birth_date=col_date(),
                         sex=col_factor()
                       ))
```

The `birth_date` column of the `students` data frame is of class `r class(students$birth_date)`.
The `sex` column of the `students` data frame is of class `r class(students$sex)`.

## Question 4 

```{r}
#| message: false
grades <- read_delim(here("data","grades.csv"),
                     delim="|",
                     na="$")
```


## Question 5 

```{r}
students|>
  ggplot(aes(x=group))+
  geom_bar()
```

## Question 6 

```{r}
students|>
  ggplot(aes(x=group, fill =sex))+
  geom_bar(position="fill")
```

## Question 7 

```{r}
students|>
  mutate(age=time_length(today() - birth_date, unit="year"))|>
  ggplot(aes(x=age))+
  geom_density(bw="sj")+
  geom_rug(alpha=0.1)
```

## Question 8 

```{r}
students|>
  mutate(age=time_length(today() - birth_date, unit="year"))|>
  summarise(`median age`=as.integer(round(median(age))),.by=group)|>
  knitr::kable()
```

## Question 9 

```{r}
students_a <- students|>
  mutate(age=time_length(today() - birth_date, unit="year"))

students_a |>
  summarise(age=max(age), .by=group)|>
  inner_join(students_a, by=join_by(age), keep=FALSE, suffix=c("",""))|>
  select(group, age, id, sex)|>
  arrange(desc(age))|>
  knitr::kable()
```

## Question 10 
The data set contains `r nrow(grades)` grades.

## Question 11
```{r}
grades_course <- inner_join(grades, course, by=join_by(course_id))
g_c_s <- inner_join(grades_course, students, by=join_by(id))
g_c_s|>
  filter(course=="Hunting and Gathering Skills")|>
  summarise(`average grade`=mean(grade, na.rm=TRUE),.by=group)|>
  ggplot(aes(x = group, y = `average grade`))+
  geom_col()
```

## Question 12

```{r}
g_c_s <- g_c_s |>
  mutate(semester = factor(semester))

g_c_s|>
  filter(!is.na(grade))|>
  ggplot(aes(x=grade))+
  geom_density(bw="sj")+
  geom_rug(alpha=0.01)+
  facet_wrap(vars(semester))
```
The standard deviation is way smaller in the first semester. 

## Question 13 

```{r}
g_c_s|>
  select(grade,id,group,sex)|>
  mutate(n=n(),.by=id)|>
  select(n,id,group,sex)|>
  slice_tail(n=5)|>
    knitr::kable()

grades|>
  mutate(n=n(),.by=id)|>
  summarise(min=min(n),max=max(n),average=mean(n),median=median(n))|>
    knitr::kable()
```

## Question 14 

```{r}
g_c_s|>
  select(grade,id,group,sex)|>
  mutate(n=n(),.by=id)|>
  select(n,id,group,sex)|>
  ggplot(aes(x=n,fill=sex))+
  geom_bar(position="fill")
```

